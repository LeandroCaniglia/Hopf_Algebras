\chapter{The Zariski Topology}

\section{Prime-adic Absolute Value}

Let $p$ be a primer number. Given $a\in\Z$, recall that the \textsl{exponent of\/ $p$ in\/ $a$} is
$$
    \nu_p(a) = \begin{cases}
        \infty   &\text{if }n=0,\\
        e   &\text{if }a=p^ek,\text{ with }p\perp k.
    \end{cases}
$$
This definition is extended to the rationals
$$
    \nu_p(a/b)=\nu_p(a)-\nu_p(b).
$$

\begin{defn}
    For $x\in\Q$, the \textsl{$p$-adic absolute value} is
    $$
        |x|_p = \begin{cases}
            p^{-\nu_p(x)}   &\text{if } x\ne0,\\
            0   &\text{otherwise}.
        \end{cases}
    $$
\end{defn}

\begin{rem}
    If $x\in\Q$, $x\ne0$, then $\nu_p(x)=e\iff x=p^ex'$ with $\nu_p(x')=0$.
\end{rem}

\begin{thm}
    The\/ $p$-adic absolute value is a \textsl{non-archimedean absolute value}, i.e., it satisfies
    \begin{enumerate}[\rm a)]
        \item $|x|_p\ge0$, with equality attained if, and only if, $x=0$,
        \item $|xy|_p=|x|_p|y|_p$,
        \item $|x+y|_p\le\max\set{|x|_p,|y|_p}$, with equality attained if $|x|_p\ne|y|_p$.
    \end{enumerate}
\end{thm}

\begin{proof}${}$
    \begin{enumerate}[\rm a)]
        \item This is a direct consequences of the definition.
        
        \item After part a) we may assume that $x,y\ne0$. Put $e=\nu_p(x)$ and $d=\nu_p(y)$. Then $x=p^ex'$ and $y=p^dy'$ with $\nu_p(x')=\nu_p(y')=0$. In consequence, $xy=p^{e+d}x'y'$ with $\nu_p(x'y')=0$.

        \item It suffices to consider the case $x+y\ne0$. With the notations of part b), we have $x+y=p^ex'+p^dy'$. Suppose that $e\ge d$. Then $x+y=p^d(p^{e-d}x'+y')$ with $\nu_p(p^{e-d}x'+y')\ge0$, with equality attained if $e-d>0$. Thus, $\nu_p(x+y)\ge d=\min\set{e,d}$, with equality attained if $e>d$.
    \end{enumerate}
\end{proof}

\begin{defn}
    Given a prime $p$, the $p$-adic absolute value defines a structure of metric space, hence a topology, in~$\Q$ whose base is given by the sets
    $$
        \set{x\in\Q\mid |x-a|_p<\epsilon},
    $$
    for $a\in\Q$ and $\epsilon>0$ in $\R$.
\end{defn}

\section{The Zariski Topology}

Let $A$ be a ring. For every subset $S\subseteq A$ we introduce
$$
    V(S) = \set{\mathfrak p\in\Spec A\mid S\subseteq\mathfrak p}.
$$
\begin{rem}
    $V(S)=V(\bar S)$, where $\bar S$ is the ideal generated by~$S$.
\end{rem}

\begin{thm}\label{thm:Zariski-topology-properties}
    The family of sets\/ $\Spec(A)\setminus V(S)$ with\/ $S\subseteq A$ is a topology on\/~$\Spec(A)$.
\end{thm}

\begin{proof} The proof can be broken up into the following parts
    \begin{enumerate}[\rm i)]
        \item $\Spec(A)=V(\set0)$,
        \item $\emptyset=V(\set1)$,
        \item $\bigcap_{i\in I}V(S_i)=V\big(\bigcup_{i\in I}S_i\big)$,
        \item $V(\bar S)\cup V(\bar T)=V(\bar S\cap\bar T)$
    \end{enumerate}
    Parts i) and ii) are trivial. For part iii) note that 
    $$
        \mathfrak p\supseteq S_i,\text{ for all }i\in I
            \iff \mathfrak p\supseteq\bigcup_{i\in I}S_i,
    $$
    simply because $\mathfrak p$ is a set. For part iv) first note that trivially
    $$
        \mathfrak p\supseteq\bar S
            \implies \mathfrak p\supseteq\bar S\cap\bar T.
    $$
    Conversely, if $\mathfrak p\supseteq \bar S\cap\bar T$ and $p\not\supseteq\bar T$, we can peek $y\in\bar T\setminus\mathfrak p$ and observe that given $x\in\bar S$, since $xy\in\bar S\cap\bar T\subseteq\mathfrak p$, we obtain $x\in\mathfrak p$. 
\end{proof}

\begin{rem}\label{rem:closed-empty-has-1}
    Note that the reciprocal of part ii) is also true. More precisely, according to Remark~\ref{rem:proper-is-in-maximal}, we have $V(S)=\emptyset\iff 1\in\gen S$.
\end{rem}

\begin{defn}
    The topology of the theorem is called the \textsl{Zariski topology of\/}~$\Spec(A)$.
\end{defn}

\begin{rem}
    Recall that the \textsl{subspace topology} of a subset $Y$ of a topological space $X$ is the one where the open subsets of $Y$ have the form $U\cap Y$ with $U$ open in $X$.

    Moreover, if $f\colon X\to Y$ is a surjective map, the \textsl{quotient topology} on $Y$ is the one where the open subsets $V$ of $Y$ are those that satisfy $f^{-1}(V)$ is open in~$X$.

    Finally, the \textsl{product topology} of $\prod_{i\in I}X_i$ is the one where the open sets are products $\prod_{i\in I}U_i$ of open sets $U_i\subseteq X_i$.
\end{rem}

\begin{defn}
    Let $(X_i)_{i\in I}$ be a family of topological spaces and $(Y_i)_{i\in I}$ a family whose $i$th member $Y_i$ is open in $X_i$. Write $X=\prod_{i\in I}X_i$ and $Y=\prod_{i\in I}Y_i$. Then
    $$
        X_Y =\set{x\in X
            \mid x_i\in Y_i \aew[I]},
    $$
    where $\aew$ stands for \textit{almost everywhere}, i.e., for all except finitely many. With these notations, the \textsl{restricted product topology on $X$ with respect to $Y$} is the one whose open sets are unions of subsets of the form
    \begin{equation}\label{eq:restricted-open}
        \prod_{i\in I} U_i,\tag{$\ast$}
    \end{equation}
    where $U_i$ is open in $X_i$ and $U_i=Y_i \aew[I]$.
\end{defn}

\begin{rem}
    The restricted product topology is well-defined:
    \begin{enumerate}[\rm i)]
        \item $X$ is open because
        $$
            X = \bigcup_{j\in I}\prod_{i\in I}Y_{j,i},
        $$
        where
        $$
            Y_{j,i} = \begin{cases}
                X_i     &\text{if }i=j,\\
                Y_j     &\text{otherwise}.
            \end{cases}
        $$

        \item $\emptyset$ is open because we can take the empty union of products to express it.

        \item Any union of unions of products like \eqref{eq:restricted-open} is a union of said products.

        \item The intersection of two unions of products like \eqref{eq:restricted-open}, 
        $$
            \Big(\bigcup_{j\in J}\prod_{i\in I}U^j_i\Big)
                \cap\Big(\bigcup_{k\in K}\prod_{i\in I}V^k_i\Big),
        $$
        is the union
        $$
            \bigcup_{\substack{j\in J\vphantom|\\k\in K\vphantom|}}
                \prod_{i\in I}U^j_i\cap V^k_i.
        $$
        Since $U^j_i=V^k_i=Y_i\aew[I]$, we deduce that $U^j_i\cap V^k_i=Y_i\aew[I]$.
    \end{enumerate}
\end{rem}

\begin{thm}
    Let\/ $f\colon A\to B$ be a morphism of rings. Endow\/ $\Spec B$ and\/ $\Spec A$ with the Zariski topology. Then the map\/ $f^\sharp\colon\Spec B\to\Spec A$ is continuous.
\end{thm}

\begin{proof}
    It suffices to show that $(f^\sharp)^{-1}(V(S))=V(f(S))$. But
    \begin{align*}
        \mathfrak q\in(f^\sharp)^{-1}(V(S))
            &\iff f^\sharp(\mathfrak q)\in V(S)\\
            &\iff f^{-1}(\mathfrak q)\supseteq S\\
            &\iff \mathfrak q\supseteq f(S)\\
            &\iff \mathfrak q\in V(f(S)).
    \end{align*}
\end{proof}

\begin{cor}
    Let\/ $\varphi\colon A\to A/\Nil(A)$ be the canonical surjection of rings, and let\/ $\varphi^\sharp\colon\Spec(A/\Nil(A))\to\Spec(A)$ be the associated map of topological spaces. Then\/ $\varphi^\sharp$ is an homeomorphism of topological spaces.    
\end{cor}

\begin{proof}
    Theorem~\ref{thm:nilpotency-characterizations} implies that $\varphi^\sharp$ is a bijection. It is continuous by the theorem. Its inverse is continuous because
    \begin{align*}
        \mathfrak p\in\varphi^\sharp(V(\bar S))
            &\iff \mathfrak p=\varphi^{-1}(\bar{\mathfrak q}),
                \text{ for some }\bar{\mathfrak q}\supseteq\bar S\\
            &\iff \mathfrak p\supseteq S\\
            &\iff \mathfrak p\in V(S).
    \end{align*}
\end{proof}

\begin{rem}
    Recall that a \textsl{base} for topology on a set $X$ is a collection~$\mathcal B$ of open sets whose members cover $X$ and such that every intersection of two elements $B_1$ and $B_2$ of $\mathcal B$ satisfies $x\in B_1\cap B_2\implies (\exists\,B\in\mathcal B)\; x\in B\subseteq B_1\cap B_2$.
\end{rem}

\begin{ntn}
    Given a ring\/ $A$, an element\/ $f\in A$ defines the \textsl{basic open set}
    $$
        D(f) = \Spec A\setminus V(f),
    $$
    which consists of the prime ideals\/ $\mathfrak p$ such that\/ $f\notin\mathfrak p$.

    Note that\/ $f\in\Nil(A)\iff D(f)=\emptyset$.

    More generally, if\/ $S\subseteq\Spec A$, we define
    $$
        D(S) = \Spec A\setminus V(S).
    $$
    Note that\/ $D(S)=D(\gen S)$, which we will also denote by\/ $D\gen S$.
\end{ntn}

\needspace{2\baselineskip}
\begin{rem}\label{rem:D(S)=Spec(A)-iff-1-in-(S)}
    After taking complements, Remark~\ref{rem:closed-empty-has-1} can be rephrased as
    $$
        D(S)=\Spec A\iff 1\in\gen S.
    $$
\end{rem}

\begin{lem}\label{lem:D-morgan}
    Given\/ $f,g\in A$, we have
    \begin{enumerate}[\rm a)]
        \item $D(f)\cap D(g)=D(fg)$,
        \item $D(f)\cup D(g)=D\gen{f,g}$.
    \end{enumerate}
\end{lem}

\begin{proof}${}$
    \begin{enumerate}[\rm a)]
        \item $\mathfrak p\in D(f)\cap D(g)\iff f\notin\mathfrak p$ and $g\notin\mathfrak p\iff fg\notin\mathfrak p\iff\mathfrak p\in D(fg)$.

        \item $\mathfrak p\in D(f)\cup D(g)
            \iff f\notin\mathfrak p$ or $g\notin\mathfrak p
            \iff \gen{f,p}\notin\mathfrak p
            \iff \mathfrak p\in D\gen{f,g}$.
    \end{enumerate}
\end{proof}

\begin{lem}\label{lem:D(f)-subseteq-D(g)}
    Let\/ $f, g$ be elements in the ring $A$. Then\/ $D(f) \subseteq D(g)$ if, and only if, $f^n\in\gen g$ for some\/ $n > 0$.
\end{lem}

\begin{proof}
    \begin{align*}
        D(f)\subseteq D(g) &\iff V(g)\subseteq V(f)\\
            &\iff g\in\mathfrak p\implies f\in\mathfrak p\\
            &\iff \bar{\mathfrak p}\in\Spec A/\gen g
                \implies\bar f\in\bar{\mathfrak p}\\
            &\iff \bar f\in\Nil(A/\gen g)
                &&\text{; Theor.~\ref{thm:nilpotency-characterizations}}\\
            &\iff f^n\in\gen g\text{ for some }n>0.
    \end{align*}
\end{proof}

\begin{thm}
    The collection\/ $\set{D(f))\mid f\in A\setminus\Nil(A)}$ is a base for the Zariski topology of\/ $\Spec A$.
\end{thm}

\begin{proof}
    By definition the sets $D(f)$ are open. They cover $\Spec A$ because, given a prime ideal $\mathfrak p$, since it is proper, there exists $f\in A$ such that $f\notin\mathfrak p$, i.e., $\mathfrak p\in D(f)$. In particular $f\notin\Nil(A)$. Finally, $D(f)\cap D(g)=D(fg)$ by Lemma~\ref{lem:D-morgan}.
\end{proof}

\begin{thm}\label{thm:Spec(Af)-is-D(f)}
    Let $f\in A\setminus\Nil(A)$. Then the open set\/ $D(f)$ is homeomorphic to\/ $\Spec A_f$, where\/ $A_f$ is the localization\/ $S^{-1}A$, for\/ $S=\set{f^n\mid n\in\N}$.
\end{thm}

\begin{proof}
    Consider the map
    \begin{align*}
        \phi\colon D(f)&\to\Spec A_f\\
            \mathfrak p&\mapsto \mathfrak pA_f.
    \end{align*}
    \needspace{2\baselineskip}
    Then $\phi$ is
    \begin{enumerate}[-]
        \item \textit{Injective:} Suppose that $\mathfrak pA_f=\mathfrak qA_f$. Given $a\in\mathfrak p$, write $a/1=b/f^n$ with $b\in\mathfrak q$ and $n\in\N$. Then $f^{k+n}a=f^kb$ for some $k\ge0$ and so $a\in\mathfrak q$. It follows that $\mathfrak p\subseteq\mathfrak q$. The other inclusion does hold for the very same reasons.

        \item \textit{Surjective:} Take $\mathfrak q\in\Spec A_f$. Define $\mathfrak p=\mathfrak q\cap A\in\Spec A$. Then $\mathfrak pA_f\subseteq\mathfrak q$. Conversely, given $b/f^n\in\mathfrak q$, we have $b\in\mathfrak q\cap A=\mathfrak p$. Hence $b/1\in\mathfrak pA_f$.

        \item \textit{Open:} Since $D(gf)=D(g)\cap D(f)$, it suffices to show that $\phi(D(gf))$ is open in $\Spec A_f$. But
        $$
            \mathfrak p\in D(fg)
                \iff fg\notin\mathfrak p
                \iff g/1\notin\mathfrak pA_f
                \iff \phi(p)\in D(g/1),
        $$
        i.e,
        \begin{equation}\label{eq:D-intersection}
            \phi(D_A(fg))=D_{A_f}(g/1).
        \end{equation}

        \item \textit{Continuous:} Since $\phi$ is bijective, equation \eqref{eq:D-intersection} implies that
        $$
            \phi^{-1}(D_{A_f}(g/f^n))=\phi^{-1}(D_{A_f}(g/1))=D_A(fg).
        $$
    \end{enumerate}
\end{proof}

\begin{rem}
    The topological space $\Spec\Z$ is not Hausdorff. What's more, given $a,b\in\Z$, if $p$ is a prime and $p\perp ab$, then $p\in D(ab)=D(a)\cap D(b)$.
\end{rem}

\begin{thm}\label{thm:Spec-is-compact}
    Let\/ $A$ be a ring. Then\/ $\Spec A$ is compact.
\end{thm}

\begin{proof}
    It suffices to show that $\Spec A$ has the Finite Intersection Property (FIP), i.e., that every empty intersection $\bigcap_{i\in I}V(S_i)$ is empty for a finite number of its members. But this is clear because, by Theorem~\ref{thm:Zariski-topology-properties},
    $$
        \emptyset=\bigcap_{i\in I}V(S_i) = V\bigg(\bigcup_{i\in I}S_i\bigg),
    $$
    which implies that $1$ is generated by the $S_i$ [cf.~Remark~\ref{rem:closed-empty-has-1}] and therefore, by a finite number of them.
\end{proof}

\begin{cor}\label{cor:D(f)-is-compact}
    Given $f\in A\setminus\Nil(A)$, the open set $D(f)$ is compact.
\end{cor}

\begin{proof}
    This is a direct consequence of the theorem and Theorem~\ref{thm:Spec(Af)-is-D(f)}.
\end{proof}

\begin{cor}\label{cor:nilpotent-and-cover}
    If a family\/ $(D(g_i))_{i\in I}$ of basic open sets is a cover of\/ $D(f)$, then\/ $f^m=a_1g_{i_1}+\cdots+a_rg_{i_r}$ for some\/ $m>0$ and\/ $a_1,\cdots, a_r\in A$.
\end{cor}

\begin{proof}
    Since $D(f)$ is compact, it can be covered with finitely many members $D(g_i)$ of the family. The conclusion follows from Remark~\ref{rem:D(S)=Spec(A)-iff-1-in-(S)} applied to~$A_f$.
\end{proof}

\begin{thm}
    The singleton\/ $\set{\mathfrak m}$ is closed in\/ $\Spec A$ if, and only if, $\mathfrak m$ is maximal.
\end{thm}

\begin{proof}
    Suppose that $\set{\mathfrak m}$ is closed. Let $\mathfrak n$ be a maximal ideal including $\mathfrak m$. If $\mathfrak n\ne\mathfrak m$, there would exist $f\in A$ with $\mathfrak n\in D(f)$ and $\mathfrak m\notin D(f)$, which is impossible because these conditions mean $f\in\mathfrak m\setminus\mathfrak n$. Thus, $\mathfrak m=\mathfrak n$ is maximal.

    Conversely, if $\mathfrak m$ is maximal, given $\mathfrak p\ne\mathfrak m$, we can pick $f\in\mathfrak m\setminus\mathfrak p$ and get $\mathfrak p\in D(f)$ and $\mathfrak m\notin D(f)$.
\end{proof}

\begin{ntn}
    The \textsl{closure} of a set\/ $S$ in a topological space\/ $X$, this is, the intersection of all closed subsets including $S$, will be denoted by\/ $\cl(S)$.
\end{ntn}

\begin{defn}
    Let $A$ be a ring. A point $\mathfrak p\in\Spec A$ is \textsl{generic} whenever $\cl\set{\mathfrak p}=\Spec A$.
\end{defn}

\begin{lem}
    $\cl\set{\mathfrak p}=V(\mathfrak p)$.
\end{lem}

\begin{proof}
    By definition, $\mathfrak p\in V(\mathfrak p)$. Since $V(\mathfrak p)$ is closed, we get $\cl\set{\mathfrak p}\subseteq V(\mathfrak p)$.

    Now assume that $\mathfrak q\notin\cl\set{\mathfrak p}$. This means that there exists $f\in A$ with $\mathfrak p\notin D(f)$ and $\mathfrak q\in D(f)$. Equivalently, $f\in\mathfrak p$ and $f\notin\mathfrak q$. Hence, $\mathfrak p\not\subseteq\mathfrak q$, i.e., $\mathfrak q\notin V(\mathfrak p)$. In othe words, $V(\mathfrak p)\subseteq\cl\set{\mathfrak p}$.
\end{proof}

\begin{prop}\label{prop:generic-point}
    Let\/ $A$ be a ring. Then\/ $\Spec A$ has a generic point if, and only if, $\Nil(A)$ is a prime ideal.
\end{prop}

\begin{proof}
    Let $\mathfrak g$ be a generic point. Then the only closed set containing $\mathfrak g$ is $\Spec A$. Thus, if $f\in\mathfrak g$, then $\mathfrak g\in V(f)$ and $V(f)=\Spec A$, i.e., $f\in\bigcap\Spec A=\Nil(A)$ by Theorem~\ref{thm:nilpotency-characterizations}. Hence, $\mathfrak g\subseteq\Nil(A)$ and equality is attained because the other inclusion is trivial.

    Conversely, if $\Nil(A)$ is prime, by the lemma, $\cl(\Nil(A))=V(\Nil(A))=\Spec A$.
\end{proof}

\begin{defn}
    A topological space is \textsl{reducible} if it can be decomposed as a union of two proper closed subsets. A topological space is \textsl{irreducible} if it is neither empty nor reducible.
\end{defn}

\begin{prop}
    Let\/ $A$ be a ring. Then\/ $\Spec A$ is irreducible if, and only if, it has a generic point.
\end{prop}

\begin{proof}
    If $\Spec A$ has a generic point, it cannot be reducible because the generic point cannot be in a proper closed set.

    Assume that $\Spec A$ is irreducible. Suppose, toward a contradiction, that $\Nil(A)$ is not a prime. Then there exist $f,g\notin\Nil(A)$ with $fg\in\Nil(A)$. Therefore, $D(f)\cap D(g)=D(fg)=\emptyset$, with $D(f)$ and $D(g)$ are nonempty. Taking complements, we get $V(f)\cup V(g)=\Spec(A)$. Contradiction.
\end{proof}

\section{Sheaves}

Given a topological space $X$ let $\cat{Open}(X)$ denote the category of open subsets of~$X$ with morphisms
$$
    \Hom(U,V) = \begin{cases}
        \set{\iota_{U,V}}    &\text{if }U\subseteq V,\\
        \emptyset   &\text{otherwise},
    \end{cases}
$$
where $\iota_{U,V}$ is the inclusion $U\hookrightarrow V$ between open subsets.

\begin{defn}
    Let $X$ be a topological space and $\cat{CRing}$ the category of commutative rings. A \textsl{presheaf} on $X$ with values in $\cat{CRing}$ is a contravariant functor $\sheaf F\colon\cat{Open}(X)\to\cat{CRing}$.
\end{defn}
    
\begin{rem}
    By definition, the presheaf $\sheaf F$ satisfies
    \begin{enumerate}[\rm i)]
        \item For each open set $U$ of $X$, there exists a (commutative) ring $\sheaf F(U)$,
        \item for each inclusion $V \hookrightarrow U$ of open sets, there is a morphism of rings
        $$
        \varrho_V^U\colon\sheaf F(U)\to\sheaf F(V)
        $$
        \item $\varrho_U^U$ is the identity map, and
        \item $\varrho^U_W = \varrho^V_W\circ\varrho^U_V$ whenever $W \hookrightarrow V \hookrightarrow U$.
    \end{enumerate}    
\end{rem}

\begin{ntn}
    The elements of\/ $\sheaf F(U)$ are called \textsl{sections}, the morphisms\/ $\varrho^U_V$ \textsl{restrictions}. If\/ $s$ is a section in\/ $\sheaf F(U)$, its restriction\/ $\varrho^U_V(s)$ to\/ $V\subseteq U$ is also denoted\/~$s|_V$.
\end{ntn}

\begin{rem}
    Actually, what we have defined are presheaves of rings. More generally, we could adapt our definition so to have presheaves in other categories. For example, consider a category $\cat G$ with two objects $V$ and $E$ and exactly two morphisms $s,t\in\Hom_{\cat G}(V,E)$. A presheaf of sets is a functor $\mathcal G\colon\cat G^{\text{op}}\to\cat{Set}$. It consists of two sets $\mathcal G(V)$, whose elements are \textsl{vertexes}, and $\mathcal G(E)$, whose elements are \textsl{edges}, plus two maps $\mathcal G(s)\colon\mathcal G(E)\to\mathcal G(V)$ and $\mathcal G(t)\colon\mathcal G(E)\to\mathcal G(V)$, respectively representing the \textsl{source} and \textsl{target} maps. 
\end{rem}

\begin{xmpl}
    Let $A$ be a ring. Recall that $\mathcal Q(A)$ is the union of all residue fields, as defined in Notation~\ref{ntn:all-residue-fields}. For every open subset $U$ of $\Spec A$ consider the set of functions
    $$
        \sheaf F(U) = \set{\phi\colon U\to\mathcal Q(A)
            \mid\phi(\mathfrak p)\in\Frac(A/\mathfrak p),\text{ for all }
            \mathfrak p\in U},
    $$
    which has a structure of commutative ring with the operations
    \begin{align*}
        \phi+\psi\colon\mathfrak p &\mapsto\phi(\mathfrak p)+\psi(\mathfrak p),\\
        \phi\psi\colon \mathfrak p &\mapsto\phi(\mathfrak p)\psi(\mathfrak p),
    \end{align*}
    for $\phi,\psi\colon U\to\mathcal Q(A)$.
    
    Take $f\in A$. Then $\ell(f)\colon\Spec A\to\mathcal Q(A)$, given by $\ell_\wp(f)=f\in\Frac(A/\wp)$ for $\wp\in\Spec A$, is an element of $\sheaf F(\Spec A)$. In particular,
    $$
        \varrho^{\Spec A}_{D(g)}(\ell(f)) = f|_{D(g)}
    $$
    is an element of $\sheaf F(D(g))$. Note that $f|_{D(g)}$ can be further restricted to $D(h)$ whenever $h^n\in\gen g$ for some $n>0$ [cf.~Lemma~\ref{lem:D(f)-subseteq-D(g)}].

    In the special case where $A=\Z$, we have
    $$
        \mathcal Q(\Z) = \Q\cup\bigcup_{p\text{ prime}}\F_p
    $$
    and, given $m\in\Z$,
    $$
        D(m) = \set{p\text{ prime}\mid p\perp m}.
    $$
    Moreover, for $m\in\N_0$, we have
    \begin{align*}
        \ell(m)\colon\Spec\Z&\to T\\
            p&\mapsto
                \begin{cases}
                    m   &\text{ if }p=0,\\
                    m\pmod p    &\text{ if }p\ne0.
                \end{cases}
    \end{align*}
    Note that $\ell\colon\N_0\to\sheaf F(\Spec\Z)$ is injective because $\ell(m)=\ell(n)$ implies $m=n\pmod p$ for all primes $p$. Taking $p> \max\set{m,n}$, we deduce that $m=n$. However, $\ell$ is clearly non-onto: take for instance any ``constant'' function in $\sheaf F(\Spec\Z)$.
\end{xmpl}

\begin{ntn}
    Recall that the map\/ $\ell$, introduced in\/ {\rm Remark~\ref{rem:defn-of-ell}}, is injective if, and only if, $\Nil(A)=0$ {\rm[cf.~Theorem~\ref{thm:nilpotency-characterizations}]}. However, we will only explicit this map to emphasize it's presence. Sometimes an element\/ $a\in A$ will be identified with its image\/ $\ell(a)$ without further clarification. This is justified by the naturality of the map. Indeed. We have the following commutative diagram
    $$
        \begin{tikzcd}
            A
                    \arrow[d,"\phi"']
                    \arrow[r,"\ell_A"]
                &{\Hom(\Spec A,\mathcal Q(A))}
                    \arrow[d,"\tilde\phi"]\\
            B
                    \arrow[r,"\ell_B"']
                &{\Hom(\Spec B,\mathcal Q(B)),}
        \end{tikzcd}
    $$
    where the arrow on the right produces\/ $\ell_B(\phi(a))$ from\/ $\ell_B(a)$ according to
    $$
        \begin{tikzcd}[column sep=large]
            \Spec A
                    \arrow[r,"\ell_A(a)"]
                &\mathcal Q(A)
                    \arrow[d]
                &\phi^{-1}(\mathfrak q)
                    \arrow[r,mapsto]
                &\bar a\in A/\phi^{-1}(\mathfrak q)
                    \arrow[d,mapsto]\\
            \Spec B
                    \arrow[r,"\ell_B(\phi(a))"']
                    \arrow[u,"\phi^\sharp"]
                &\mathcal Q(B)&\mathfrak q
                    \arrow[u,mapsto]
                    \arrow[r,mapsto]
                &\bar\phi(\bar a)\in B/\mathfrak q
        \end{tikzcd}
    $$
    which shows that the assignment\/ $a\mapsto\ell(a)$ ``commutes'' with ring morphisms. More precisely, since\/ $\bar\phi\colon A/\phi^{-1}(\mathfrak q)\to B/\mathfrak q$ is injective, $\bar a\in A/\phi^{-1}(\mathfrak q)$ can be identified with\/ $\bar\phi(\bar a)\in B/\mathfrak q$.
\end{ntn}

\begin{defn}\label{defn:locally-rational}
    Let $A$ be a ring. Recall that a rational function on an open set $U\subseteq\Spec A$, as introduced in Notation~\ref{ntn:all-residue-fields}, is a map of the form $a_U/b_U$, where $b_U\notin\mathfrak p$ for $\mathfrak p\in U$. More generally, a function $\phi\colon U\to\mathcal Q(A)$ is \textsl{locally rational\/} if there is a cover\/ $(D(f_i))_{i\in I}$ of\/ $U$ consisting of basic open sets such that for every\/ $i\in I$ the restriction $\phi|_{D(f_i)}$ can be expressed as $a_i/f_i$.
\end{defn}

\begin{lem}
    Let\/ $V\subseteq U$ be open sets in\/ $\Spec A$. Then, the restriction\/ $\phi|_V$ of a locally rational function\/ $\phi\colon U\to\mathcal Q(A)$ is locally rational.
\end{lem}

\begin{proof}
    Pick a cover $(D(f_i))_{i\in I}$ of $U$ where we can write $\phi|_{D(f_i)}=a_i/f_i$. 
    
    Take a cover $(D(g_j))_{j\in J}$ of $V$. Since $D(f_i)\cap D(g_j)=D(f_ig_j)$, we can refine the latter cover to $(D(f_ig_j))_{(i,j)\in I\times J}$. Moreover, the restriction of $\phi$ to $D(f_ig_j)$ is rational because it can be expressed as $a_ig_j/(f_ig_j)$. 
\end{proof}

\begin{thm}
    Let\/ $A$ be a ring. Given\/ $U\subseteq\Spec A$ open, the map
    \begin{align*}
        U\mapsto\qsheaf A(U) &= \set{\phi\colon U\to\mathcal Q(A)
            \mid \phi\text{\rm\ is locally rational}}
    \end{align*}
    defines a presheaf on\/~$\Spec A$.
\end{thm}

\begin{proof}
    Firstly note that $\qsheaf A(U)$ is a commutative ring:
    \begin{enumerate}[-]
        \item \textit{zero:} the function $\mathfrak p\mapsto 0$.
        \item \textit{one:} the function $\mathfrak p\mapsto 1$.
        \item[]Take a cover $(D(f_i))_{i\in I}$ where $\phi$ is $a_i/f_i$ and another $(D(g_j))_{j\in J}$ where $\psi$ is $b_j/g_j$. Fix $i$ and $j$. Then, 
        \item \textit{sum:} 
        $$
            (\phi+\psi)|_{D(f_ig_j)}
                = (a_ig_j+b_jf_i)
                /(f_ig_j).
        $$
        \item \textit{product:}
        $$
            (\phi\cdot\psi)|_{D(f_ig_j)}
                = a_ib_j/(f_ig_j).
        $$
    \end{enumerate}
    Since $(D(f_ig_j))_{i\in I,j\in J}$ is a cover of $U$, both $\phi+\psi$ and $\phi\cdot\psi$ are locally rational.
    
    Secondly, the requirement on the restrictions $\varrho^U_V$ for $V\subseteq U$ is a direct consequence of the lemma.
\end{proof}

\begin{prop}\label{prop:D(f)-is-Af}
    Let $A$ be a ring. The presheaf of locally rational functions satisfies\/ $\qsheaf A(D(f))=\ell(A_f)$, for all\/ $f\in A$. In particular $\qsheaf A(\Spec A)=\ell(A)$.
\end{prop}

\needspace{2\baselineskip}
\begin{proof}${}$
    \begin{enumerate}
        \item[$\supseteq$)] Trivial. 
        \item[$\subseteq$)] Take $\phi\in\qsheaf A(D(f))$. By definition there is a cover $(D(f_i))_{i\in I}$ of $D(f)$ such that $\phi=a_i/f_i$ in $D(f_i)$. We can apply Corollary~\ref{cor:nilpotent-and-cover} to obtain the existence of finitely many $f_i$, say $f_{i_1},\dots, f_{i_r}$, such that
        $$
            f^n = c_1f_{i_1} + \cdots + c_rf_{i_r},
        $$
        for some $n\ge0$ and $c_1,\dots,c_r\in A$. Multiplying by $\phi$,
        $$
            \phi f^n=c_1a_{i_1}+\cdots+c_ra_{i_r}\in A,
        $$
        which shows that $\phi\in A_f$.
    \end{enumerate}
\end{proof}

\begin{prop}\label{prop:Af->Ag}
    Let\/ $A$ be a ring. Given\/ $f$ and\/ $g$ in\/ $A$ then\/ $D(g)\subseteq D(f)$ if, and only if, there exist\/ $n>0$ and\/ $a\in A$ such that\/ $g^n=af$. In particular, when this is the case, there is a morphism\/ $A_f\to A_g$ that maps\/ $1/f$ to\/ $a/g^n$.
\end{prop}

\begin{proof}
    The \textit{if\/} part being trivial, it suffices to proceed with the \textit{only if\/} one. Assume that $D(g)\subseteq D(f)$ and suppose, for the sake of contradiction, that $S=\set{g^n\mid n\ge0}$ does not intersect the ideal $\gen f$. Let $\wp$ be an ideal that is maximal among those containing $f$ and having no intersection with $S$. We claim that $\wp$ is prime. Indeed; given $ab\in\wp$, if $a\notin\wp$ we must have $g^n\in\gen{a,\wp}$ for some $n\ge0$. Similarly, if $b\notin\wp$, then $g^m\in\gen{b,\wp}$ for some $m\ge0$. It follows that
    $$
        g^{n+m} \in \gen{a,\wp}\gen{b,\wp} \subseteq\gen{ab,\wp}=\wp,
    $$
    which is impossible because $S\cap\wp=\emptyset$. We conclude that $f\in\wp\in D(g)$, in contradiction with the hypothesis $D(g)\subseteq D(f)$.
\end{proof}

\begin{rem}
    The morphism $A_f\to A_g$ of the proposition is independent from $n$ and $a$. To see this suppose that $g^m=bf$. Then, $ag^m=abf=bg^n$ in $A$, and so $a/g^n=b/g^m$ in $A_g$.
\end{rem}

\begin{rem}\label{rem:basic-restrictions-equal-Af->Ag}
    Given $f,g\in A$ with $D(g)\subseteq D(f)$, Proposition~\ref{prop:D(f)-is-Af} implies that the restriction map
    $$
        \rho^{D(f)}_{D(g)}\colon\qsheaf A(D(f))\to\qsheaf A(D(g))
    $$
    induces a morphism $\ell(A_f)\to\ell(A_g)$. This morphism derives from the one of Proposition~\ref{prop:Af->Ag}. Indeed, given $\phi\in\qsheaf A(f)$, there exist $n\ge0$ and $a\in A$ such that $\phi=a/f^n$. According to \ref{prop:Af->Ag}, we can write $g^m=bf$ for some $m\ge0$ and $b\in A$. Therefore, we have
    $$
        \phi|_D(g)=a_{D(g)}/f^n_{D(g)}=ab^n/g^{mn},
    $$
    where $ab^n/g^{mn}=a(b/g^m)^n$ is the image of $a/f^n$ under the morphism $A_f\to A_g$ that maps $1/f$ to $b/g^m$.
\end{rem}
\begin{defn}\label{defn:sheaf}
    A presheaf $\sheaf F$ on the topological space $X$ is a \textsl{sheaf} if it satisfies the following two additional conditions:
    \begin{enumerate}[\rm a)]
        \item Given $f,g\in\sheaf F(U)$ if there exists a cover $(U_i)_{i\in I}$ of $U$ such that $f|_{U_i}=g|_{U_i}$ for all $i\in I$, then $f=g$.

        \item If $(U_i)_{i\in I}$ is a cover of $U$ for which there is a family $(f_i)_{i\in I}$ with $f_i\in\sheaf F(U_i)$ for all $i\in I$ such that $f_i|_{U_i\cap U_j}=f_j|_{U_i\cap U_j}$ for all $i,j\in I$, then there exists $f\in\sheaf F(U)$ such that $f|_{U_i}=f_i$ for $i\in I$.
    \end{enumerate}
\end{defn}


\begin{thm}
    Let\/ $A$ be a ring. Then the presheaf\/ $\qsheaf A$ is a sheaf.
\end{thm}

\begin{proof}${}$ We have to verify parts a) and b) of Definition~\ref{defn:sheaf}.
    \begin{enumerate}[\rm a)]
        \item Let $U\subseteq\Spec A$ open and suppose that $f,g\in\sheaf F(U)$ satisfy $f|_{U_i}=g|_{U_i}$ for a cover $(U_i)_{i\in I}$ of $U$. Then, given $\mathfrak p\in U$, we can  pick $i\in I$ such that $\mathfrak p\in U_i$. Hence, $f(\mathfrak p)=f|_{U_i}(\mathfrak p)=g|_{U_i}(\mathfrak p)=g(\mathfrak p)$. In consequence, $f=g$.

        \item With the notations of the definition, given $\mathfrak p\in U$ take $i\in I$ such that $\mathfrak p\in U_i$ and write $f(\mathfrak p)=f_i(\mathfrak p)$. Since $f_i(\mathfrak p)=f_j(\mathfrak p)$ if $\mathfrak p\in U_j$, we deduce that the map $f$ is well defined. Moreover, $f$ is locally rational because $f|_{U_i}=f_i$, which is locally rational.
    \end{enumerate}
\end{proof}

\begin{defn}\label{defn:stalk}
    Given a presheaf $\sheaf F$ on a topological space $X$, the \textsl{stalk} of~$\sheaf F$ at a point $x\in X$ is the quotient
    $$
        \sheaf F_x = \set{(s,U)\mid x\in U\,s\in\sheaf F(U)}/{\sim}
    $$
    where the equivalence relation is given by
    $$
        (s,U)\sim(t,V) \iff s|_W = t|_W
            \text{ for some }x\in W\subseteq U\cap V.
    $$
    The elements of $\sheaf F_x$ are called \textsl{germs}.
\end{defn}

\begin{rem}
    As ring operations in $\sheaf F(U)$ are defined pointwise, $\sheaf{F}_x$ inherits a ring structure, thereby making the projections $\sheaf{F}(U) \to \sheaf{F}_x$ ring morphisms.
\end{rem}

\begin{thm}
    Let\/ $A$ be a ring. Then, for every\/ $\mathfrak p\in\Spec A$, the stalk\/~$\qsheaf{A,\mathfrak p}$ is isomorphic to the local ring\/ $A_{\mathfrak p}/\mathfrak pA_{\mathfrak p}$.
\end{thm}

\begin{proof}
    Fix $\mathfrak p\in\Spec A$. If $\mathfrak p\in U$ and $s\in\qsheaf A(U)$, there exists $f\in A$ with $\mathfrak p\in D(f)\subseteq U$ such that $s|_{D(f)}=a/f$. Therefore, $(s, U)\sim(a/f,D(f))$ and so the class $s_{\mathfrak p}$ of $(s,U)$ in $\qsheaf{A,\mathfrak p}$ equals the class of $(a/f,D(f))$. Moreover, if $(b,g)$ is another such pair, then $a/f=b/g$ in $D(f)\cap D(g)=D(fg)$. This implies that $(fg)^n(ag-bf)\in\mathfrak p$ for some $n>0$. Since $fg\in A\setminus\mathfrak p$, it is a unit in $A_{\mathfrak p}$ and so $ag-bf=0$ in $\Frac(A/\mathfrak p)$. Hence, $a/f=b/g$ in $A_{\mathfrak p}/\mathfrak pA_{\mathfrak p}$. This shows that the map $\qsheaf{A,\mathfrak p}\to A_{\mathfrak p}/\mathfrak pA_{\mathfrak p}$, given by $s_{\mathfrak p}\mapsto a/f$ is well defined. The map is onto because, given $a/f\in A_{\mathfrak p}$, we must have $f\notin\mathfrak p$ and so the class of $(a/f,D(f))$ in $\qsheaf{A,\mathfrak p}$ is mapped to~$a/f$. The map in injective because
    \begin{align*}
        a/f\in \mathfrak pA_{\mathfrak p}
            &\implies ua\in\mathfrak p\text{ in } A
                \text{ for some }u\in A\setminus\mathfrak p\\
            &\implies \ell(a) = 0 \text{ in }D(u)
                \text{ with }\mathfrak p\in D(u)\\
            &\implies (\ell(a), D(u)) \sim (0,D(u)),
                \,\mathfrak p\in D(u)\\
            &\implies (a/f, D(uf))\sim(0,D(uf)),
                \,\mathfrak p\in D(uf)\\
            &\implies (a/f)_{\mathfrak p}=0
                \text{ in }\qsheaf{A,\mathfrak p}.
    \end{align*}
\end{proof}

\subsection{The Right Approach}

If $A$ is a ring and $\mathfrak p$ a prime ideal of $A$, then the only maximal ideal in the local ring $A_{\mathfrak p}$ is $\mathfrak pA_{\mathfrak p}$, and the quotient $A_{\mathfrak p}/\mathfrak pA_{\mathfrak p}$ equals $\Frac(A/\mathfrak p)$. In consequence, there is a natural ring epimorphism $A_{\mathfrak p}\to\Frac(A/\mathfrak p)$. This means that every map from an open set $U\subseteq\Spec A$ to $\coprod_{\mathfrak p\in U}A_{\mathfrak p}$ produces, by composition, a function with codomain $\coprod_{\mathfrak p\in U}\Frac(A/\mathfrak p)$. Thus, a question arises: what should we require from the former map so that the latter is locally rational?

Take a map $\phi\colon U\to\coprod_{\mathfrak p\in U}A_{\mathfrak p}$ and let $\bar\phi\colon U\to\coprod_{\mathfrak p\in U}
\Frac(A/{\mathfrak p})$ be the function induced by composition. Our requirement above consists in imposing the existence of a cover $(D(f_i))_{i\in I}$ of $U$ where
$$
    \bar\phi(\mathfrak p)
        =\bar a_i/\bar f_i\quad\text{in }
            A_{\mathfrak p}/\mathfrak pA_{\mathfrak p}
            = \Frac(A/\mathfrak p),
$$
for all $\mathfrak p\in D(f_i)$. One simple way to fulfill this condition is to require from~$\phi$ that it must equal a quotient $a/f$ in some neighborhood $V$ containing $\mathfrak p$. Replacing $V$ with some basic open set $D(g)$, and replacing $a$ and $f$ by $ag$ and $fg$, we may assume that such a neighborhood is $D(f)$. Thus, this conventional notion establishes that $\phi$ is \textsl{locally regular} if for each $\mathfrak p\in U$ there exist $a$ and $f$ in $A$ with $\mathfrak p\in D(f)\subseteq U$ and such that $\phi(\mathfrak q)=a/f$ in $A_\mathfrak q$ for every $\mathfrak q\in D(f)$.

As it is easy to verify, restrictions of these functions are of the same kind. In consequence, we are in presence of a presheaf. But it is also a sheaf because its properties are inherently local. It is called the \textsl{structure sheaf} of $\Spec A$ and denoted $\osheaf{\Spec A}$.

\begin{rem}
    Let's redefine the map $\ell$ from Definition~\ref{rem:defn-of-ell} so that it now transforms elements of $A$ in functions with codomain in $\coprod_{\mathfrak p}A_{\mathfrak p}$, i.e., so that, for every $f\in A$, we have the following diagram
    $$
        \begin{tikzcd}[row sep=large]
            \Spec A
                    \arrow[r,"\ell(f)"]
                    \arrow[rd,"\bar\ell(f)"']
                &\coprod_{\mathfrak p}A_{\mathfrak p}
                    \arrow[d,"\coprod_{\mathfrak p}\pi_{\mathfrak p}"]\\
                &\coprod_{\mathfrak p}\Frac(A/\mathfrak p)
        \end{tikzcd}
    $$
    where $\bar\ell(f)$ is the old $\ell$, $\pi_{\mathfrak p}\colon A_{\mathfrak p}\to\Frac(A/\mathfrak p)$ is the natural projection, and $\mathfrak p$ runs over~$\Spec A$.  Now the condition $\ell(f)=0$ is equivalent to
    $$
        \forall\,\mathfrak p\in\Spec A,\,
            \exists\, u_{\mathfrak p}\in A\setminus\mathfrak p:
                u_{\mathfrak p}f=0.
    $$
    Since $(D(u_{\mathfrak p}))_{\mathfrak p\in\Spec A}$ is cover of $\Spec A$, which is compact, we can pick a finite subcover $(D(u_i))_{1\le i\le r}$ such that $u_if=0$ for all~$i$. It follows that we can write $1=a_1u_1+\cdots+a_ru_r$. Multiplying by $f$ we get $f=0$, which shows that the new~$\ell$ is injective [compare this fact with~Theorem~\ref{thm:nilpotency-characterizations}].
\end{rem}

\begin{thm}\label{thm:structure-fibers}
    Let\/ $A$ be a ring, and\/ $\osheaf{}=\osheaf{\Spec A}$ its structure sheaf. Then,
    \begin{enumerate}[\rm a)]
        \item For any\/ $\mathfrak p\in \Spec A$, the stalk\/ ${\osheaf{}}_{\mathfrak p}$ is isomorphic to the local ring\/ $A_{\mathfrak p}$.
        \item For any element\/ $f \in A$, the map\/ $\ell$ induces an isomorphism from the localized ring\/ $A_f$ onto\/ $\osheaf{}(D(f))$.
        \item In particular, ${\osheaf{}}(\Spec A)\cong A$.
    \end{enumerate}
\end{thm}

\begin{proof}${}$
    \begin{enumerate}[\rm a)]
        \item Take $\mathfrak p\in\Spec A$. Given a pair $(s,U)$ as in Definition~\ref{defn:stalk} of~${\osheaf{}}_{\mathfrak p}$, consider the evaluation map $\op{ev}_{\mathfrak p}\colon(s,U)\mapsto s(\mathfrak p)$. Since $\op{ev}_{\mathfrak p}(s,U)=\op{ev}_{\mathfrak p}(t,V)$ whenever $(s,U)\sim(t,v)$, we get a well defined map $\phi\colon{\osheaf{}}_{\mathfrak p}\to A_{\mathfrak p}$. Moreover, $\phi$ is a ring morphism because $\op{ev}_{\mathfrak p}$ is a ring morphism. We claim that $\phi$ is an isomorphism:
        \begin{description}
            \item[\rm\textit{epi:}] Given $a/f\in A_p$ define $s\in{\osheaf{}}(D(f))$ as $s(\mathfrak q)=a/f$ in $A_{\mathfrak q}$.
            \item[\rm\textit{mono:}] Suppose that $(s,U)$ satisfies $s(\mathfrak p)=0$ in $A_{\mathfrak p}$. Replacing $U$ with a basic open set $D(f)$ we may assume that $s$ can be expressed as $a/f$. Then, $a/f=0$ in $A_{\mathfrak p}$ and so there exists $u\notin\mathfrak p$ such that $ua=0$ in~$A$. It follows that $a/f=0$ in $D(uf)$ with $\mathfrak p\in D(uf)$, i.e., $(s,D(uf))$ evaluates to $0$ everywhere, meaning that it represents the class of $(0,D(uf))$ in ${\osheaf{}}_{\mathfrak p}$.
        \end{description}

        \item First note that every element $a/f^n\in A_f$ defines a function in ${\osheaf{}}(D(f))$. For the converse, take $s\in{\osheaf{}}(D(f))$. By definition, there is a cover $(D(g_i))_{i\in I}$ of $D(f)$ where the restriction of $s$ to $D(g_i)$ can be expressed as $a_i/f_i$. Since $D(f)$ is compact, we can pick a finite subcover $(D(f_{i_j}))_{1\le j\le r}$ of $D(f)$. Applying Corollary~\ref{cor:nilpotent-and-cover}, we get
        $$
            f^n = c_1f_{n_1}+\cdots+c_nf_{n_r}\quad\text{in }A.
        $$
        Multiplying by $\phi$ we obtain
        $$
            \phi f^n=c_1a_{i_1}+\cdots+c_ra_{i_r},
        $$
        which shows that $\phi$ can be represented in $D(f)$ by an element of $A_f$.

        \item This is part b) for $f=1$.
    \end{enumerate}
\end{proof}

\section{Representable Functors}

Let $\kappa$ be a ring. In this section we direct our focus to the category $\cat{CAlg}_\kappa$, of (commutative) $\kappa$-algebras with unit.

Recall that given a $\kappa$-algebra $A$, the assignments
\begin{align*}
    X&\mapsto\Hom_{\cat{CAlg}_\kappa}(A,X)\\[0.1in]
    X\stackrel{\phi}{\to}Y&\mapsto\scalemath{0.8}{\begin{aligned}
        \Hom_{\cat{CAlg}_\kappa}(A,X)&\to\Hom_{\cat{CAlg}_\kappa}(A,Y)\\
        f&\mapsto\phi\circ f
    \end{aligned}}
\end{align*}
define the (covariant) functor $\Hom_{\cat{CAlg}_\kappa}(A,-)$. More generally, we have the following

\begin{defn}
    A functor $F\colon\cat{CAlg}_\kappa\to\cat{Set}$ is \textsl{representable} if there exists a $\kappa$-algebra $A$ such that $F$ is naturally isomorphic to $\Hom_{\cat{CAlg}_\kappa}(A,-)$. In such a case we write $F\models A$.
\end{defn}

\begin{rem}
    Given a $\kappa$-algebra $A$ consider the structure functor $\osheaf A$ and let $\yoneda_A$ denote the functor $\Hom_{\cat{CAlg}_\kappa}(A,-)$. Recall from Theorem~\ref{thm:structure-fibers} that, given $f,g\in A$ with $D(g)\subseteq D(f)$, the restriction map
    $$
        \rho^{D(f)}_{D(g)}\colon\osheaf A(D(f))\to\osheaf A(D(g))
    $$
    induces the morphism $A_f\to A_g$ of Proposition~\ref{prop:Af->Ag}.
\end{rem}

\begin{thm}\label{thm:yoneda}
    {\rm[Yonedaâ€™s Lemma]} Let\/ $A$ and\/ $B$ two objects in a category\/~$\cat C$. Let\/ $\yoneda_A=\Hom_{\cat C}(A,-)$ and\/ $\yoneda_B=\Hom_{\cat C}(B,-)$ be two representable functors from\/ $\cat C$ to\/ $\cat{Set}$. Then the collection of morphisms\/ $\Hom_{\cat C}(A,B)$ is in a one-to-one correspondence with the collection of natural transformations from\/~$\yoneda_B$ to\/~$\yoneda_A$.
\end{thm}

\begin{proof}
    Let $\phi\colon A\to B$ be a morphism. For any object $Y$ define
    \begin{align*}
        \eta_{\phi,Y}\colon \yoneda_B(Y)&\to\yoneda_A(Y)\\
        \zeta&\mapsto\zeta\circ\phi.
    \end{align*}
    Given $u\colon Y\to Z$ we have $\yoneda_B(u)(\zeta)=u\circ\zeta$ for $\zeta\in\yoneda_B$ and $\yoneda_B(u)(\xi)=u\circ\xi$ for $\xi\in\yoneda_A$. Put $(\eta_\phi)_Y=\eta_{\phi,Y}$. Then $\eta_\phi\colon\yoneda_B\to\yoneda_A$ is natural because the diagram
    $$
        \begin{tikzcd}
            \yoneda_B(Y)
                    \arrow[r,"\eta_{\phi,Y}"]
                    \arrow[d,"\yoneda_B(u)"']
                &\yoneda_A(Y)
                    \arrow[d,"\yoneda_A(u)"]
                &\zeta
                    \arrow[r,mapsto]
                    \arrow[d,mapsto]
                &\zeta\circ\phi
                    \arrow[d,mapsto]\\
            \yoneda_B(Z)
                    \arrow[r,"\eta_{\phi,Z}"']
                &\yoneda_A(Z)&u\circ\zeta
                    \arrow[r,mapsto]
                &u\circ\zeta\circ\phi
        \end{tikzcd}
    $$
    commutes.
    
    Conversely, take a natural transformation $\eta\colon\yoneda_B\to\yoneda_A$. Since $\eta_B$ takes endomorphisms of $B$ to morphisms from $A$ to $B$, we know that $\psi_\eta=\eta_B(\id_B)$ is such a morphism.

    It remains to be seen that both maps are reciprocal.

    \begin{description}
        \item[$\mbf{\Hom\to\op{Nat}\to\Hom:}$] Take $\phi\colon A\to B$. Then,
        \begin{align*}
            \phi&\mapsto\eta_\phi\mapsto\psi_{\eta_\phi}\\
            \psi_{\eta_\phi} &= (\eta_\phi)_B(\id_B)\\
                &= \eta_{\phi,B}(\id_B)\\
                &= \id_B\circ\phi\\
                &= \phi.
        \end{align*}
        \item[$\mbf{\op{Nat}\to\Hom\to\op{Nat}:}$] Take $\eta\colon\yoneda_B\to\yoneda_A$. Given $\zeta\colon B\to Y$, we have a commutative diagram
        $$
            \begin{tikzcd}
                \yoneda_B(B)
                        \arrow[d,"\yoneda_B(\zeta)"']
                        \arrow[r,"\eta_B"]
                    &\yoneda_A(B)
                        \arrow[d,"\yoneda_A(\zeta)"]
                    &\id_B
                        \arrow[r,mapsto]
                        \arrow[d,mapsto]
                    &\psi_\eta
                        \arrow[d,mapsto]\\
                \yoneda_B(Y)
                        \arrow[r,"\eta_Y"']
                    &\yoneda_A(Y)&\zeta\circ\id_B=\zeta
                        \arrow[r,mapsto]
                    &\zeta\circ\psi_\eta
            \end{tikzcd}
        $$
        Therefore,
        \begin{align*}
            (\eta_{\psi_\eta})_Y(\zeta) &= \eta_{\psi_\eta,Y}(\zeta)\\
                &= \zeta\circ\psi_\eta\\
                &= \eta_Y(\zeta),
        \end{align*}
        which shows that $\eta_{\psi_\eta}=\eta$, as desired.
    \end{description}
\end{proof}

\begin{rem}
    The contravariant version of $\yoneda_A$, i.e., the functor $\Hom_{\cat C}(-,A)$ is denoted by~$\yoneda^A$.
\end{rem}

\begin{rem}\label{rem:two-categories}
    A particular case of importance for our purposes is when $\cat C$ is the category $\cat{CAlg}_\kappa$ of commutative $\kappa$-algebras. Sometimes, however, $\cat C$ will be the category where its objects are $\kappa$-algebras but its morphisms are $\kappa$-linear, i.e., $\Hom_{\cat C}(A,K)=\Hom_\kappa(A,K)$. Note that since $\id_A$ is both a morphism of $\kappa$-algebras and of $\kappa$-modules, any natural transformation $\eta\colon\yoneda_A\to\yoneda_B$ will map it to a morphism $\phi\colon B\to A$ of the corresponding type, i.e., of $\kappa$-algebras or $\kappa$-modules.
\end{rem}

\begin{xmpl}
    Let $\kappa$ be a field and $\cat{Mat}_\kappa$ the category whose objects are natural numbers and $\Hom(m,n)=\kappa^{n\times m}$, for $n,m\in\N$, with composition defined by matrix multiplication and $\id_n$ being the identity matrix in $\kappa^{n\times n}$.

    Let's consider two natural transformation from $\Hom(m,-)$ to~$\Hom(m,-)$
    \begin{enumerate}[\rm a)]
        \item $\chi_{ij}$ swaps columns $i$ and $j$.
        \item $\sigma_{i+\lambda j}$ sums $\lambda$ times column $j$ to column $i$. 
    \end{enumerate}
    To see this, let's introduce the function $C_k$ that maps a matrix to its $k$th column. Take $A\in\Hom(n,r)=\kappa^{r\times n}$.
    \begin{enumerate}[\rm a)]
        \item Then the diagram
        $$
            \begin{tikzcd}
                \kappa^{n\times m}
                        \arrow[r,"(\chi_{ij})_n"]
                        \arrow[d,"\mu_A"']
                    &\kappa^{n\times m}
                        \arrow[d,"\mu_A"]
                    &M
                        \arrow[r,mapsto]
                        \arrow[d,mapsto]&(M)_{i\leftrightarrow j}
                        \arrow[d,mapsto]\\
                \kappa^{r\times m}
                        \arrow[r,"(\chi_{ij})_r"']
                    &\kappa^{r\times m}
                    &AM
                        \arrow[r,mapsto]
                    &\substack{
                        A(M)_{i\leftrightarrow j}\\
                        =\hphantom{{}_{i\leftrightarrow j}}\\
                        (AM)_{i\leftrightarrow j}
                    }
            \end{tikzcd}
        $$
        commutes because $C_k(AM)=AC_k(M)$.

        \item Similarly,
        $$
            \begin{tikzcd}
                \kappa^{n\times m}
                        \arrow[r,"(\sigma_{ij})_n"]
                        \arrow[d,"\mu_A"']
                    &\kappa^{n\times m}
                        \arrow[d,"\mu_A"]
                    &M
                        \arrow[r,mapsto]
                        \arrow[d,mapsto]&(M)_{i\leftarrow i+\lambda j}
                        \arrow[d,mapsto]\\
                \kappa^{r\times m}
                        \arrow[r,"(\sigma_{ij})_r"']
                    &\kappa^{r\times m}
                    &AM
                        \arrow[r,mapsto]
                    &\substack{
                        A(M)_{i\leftarrow i+\lambda j}\\
                        =\hphantom{{}_{i\leftarrow i+\lambda j}}\\
                        (AM)_{i\leftarrow i+\lambda j}
                    }
            \end{tikzcd}
        $$
        commutes for the same reason.
    \end{enumerate}
    Now, according to Yoneda, these natural transformations correspond to the right multiplication for the matrices obtained by the images of $\id_m$, i.e.,
    $$
        (\chi_{ij})_n(M) = MI_{i\leftrightarrow j}
        \quad\text{and}\quad
        (\sigma_{i+\lambda j})_n(M) = MI_{i\leftarrow i+\lambda j}
    $$
    where the $I$-matrices denote the corresponding elementary operations applied to the identity.
\end{xmpl}

\section{Exercises}

\begin{exr}
    Consider the Zariski topology on\/ $\Spec\Z$. Determine whether the following subsets are closed, open, neither, or both.
    \begin{enumerate}[\rm a)]
        \item $\set{\gen0,5,7,11,\dots}$
        \item $\set{11}$
        \item $\set{5,7,11,\dots}$
    \end{enumerate}
\end{exr}

\begin{solution}
    \begin{enumerate}[\rm a)]
        \item This equals $\Spec\Z\setminus\set{2,3}$ and so it is open because $\set2$ and $\set3$ are closed. It is not closed because $\set{2,3}$ isn't open. The reason is that if it were, there would exist some $m\in\Z$ with $D(m)\subseteq\set{2,3}$, meaning that the only prime numbers not dividing $m$ are $2$ and $3$, which is impossible.

        \item This is closed. It isn't open for the same reasons explained in part~a)

        \item Suppose that $\set{\gen0,2,3}$ is closed. Then there would exist an ideal $I$ with $V(I)=\set{\gen0,2,3}$. Since $\Z$ is principal, we would have some $m\in\Z$ with $p\mid m\iff p\in\set{0,2,3}$, which is impossible because $0\mid m\iff m=0$.

        Suppose that $\set{\gen0,2,3}$ is open. Then, there would exist $m\in\Z$ such that $\gen0\in D(m)\subseteq\set{\gen0,2,3}$. But $\gen0\in D(m)$ means that $m\notin\gen0$, i.e., $m\ne0$ and $p\notin D(m)$ for $p>3$ means that $p\mid m$ for infinitely many primes, which may only happen if $m=0$.
    \end{enumerate}
\end{solution}

\begin{exr}
    Suppose that\/ $\Q$ is endowed with the\/ $|\,\cdot\,|_p$-topology. Show that the map\/ $\phi\colon\Q\to\Q$ defined as\/ $\phi(x)=x^2$ is continuous.
    
    \textrm{\rm Hint: First show that the maps $f(x)=x$ and $g(x)=-x$ are continuous.}
\end{exr}

\begin{solution}
    Clearly $f$ is continuous because the identity is continuous on any distance: $|f(x+h) - x|_p = |h|_p$.

    In the case of $g$ we have $|g(x+h)-g(x)|_p = |-x-h+x|_p=|-h|_p=|h|_p$, which shows that $g$ is continuous too.

    To prove that $\phi$ is continuous at $a$, we have to show that given $\epsilon>0$ there exists $\delta>0$ such that $|x-a|_p<\delta\implies|x^2-a^2|_p<\epsilon$.

    Take $\epsilon>0$. Suppose that $|x-a|_p<\delta$ and $|x-a|_p|x+a|_p=|x^2-a^2|_p\ge\epsilon$. Then $\delta|x+a|_p>\epsilon$. Since $|1|_p=1$,
    $$
        |2a|_p=|2|_p|a|_p\le|1+1|_p|a|_p\le|1|_p|a|_p\le|a|_p.
    $$
    Suppose that $a\ne0$. If $|a|_p>\delta$, we get
    $$
        |x+a|_p=|x-a + 2a|_p\leq\max\set{|x-a|_p,|2a|_p}
            \le \max\set{\delta,|a|_p} = |a|_p.
    $$
    In consequence, $\epsilon < \delta|x+a|_p\le\delta|a|_p$. Thus, for $\delta=\min\set{\epsilon/|a|_p,|a|_p/2}$, we get a contradiction.

    If $a=0$, $|x^2-a^2|_p=|x^2|_p=|x|_p^2<\delta^2$, and it suffices to take $\delta<\min\set{\epsilon,1}$.
\end{solution}

\begin{exr}
    Prove that\/ $\Q$ in the\/ $|\,\cdot\,|_p$-topology is not homeomorphic to\/~$\Q$ endowed with the subspace topology induced by the standard topology on\/~$\R$.
\end{exr}

\begin{solution}
    Consider the ball $B_p(0,1)$ in the $p$-topology of $Q$. By definition
    $$
        B_p(0,1) = \set{x\in\Q:|x|_p<1}
            = \set{a/b\in\Q: p\mid a\text{ and }p\perp b}.
    $$
    The ball is open in the $p$-topology. However, it is not open in the $\R$-topology because $p\in B_p(0,1)$ and for every $\epsilon>0$, the rational
    $$
        p-\frac1{p^n}=\frac{p^{n+1}-1}{p^n}
    $$
    is not in the ball and satisfies $p-\epsilon<p-1/p^n<p$ for $p^n>1/\epsilon$.
\end{solution}

\begin{exr}
    Prove that\/ $\Q$ is Hausdorff in the\/ $|\,\cdot\,|_p$-topology.
\end{exr}

\begin{solution}
    Otherwise, for every $n>0$ we would be able to pick
    $$
        \frac{s_n}{t_n}\in B_p(\tfrac ab,p^{-n})\cap B_p(\tfrac cd,p^{-n}),
    $$
    i.e.,
    $$
        \frac{s_nb-t_na}{t_nb}\quad\text{and}\quad
            \frac{s_nd-t_nc}{t_nd}\quad
    $$
    have $\nu_p>n$.
    
    Suppose that $c/d=0$. Then, $\nu_p(s_n/t_n)>n$ and we may assume that $p\perp t_n$ and $p^n\mid s_n$. Since $p^n\mid s_nb-t_na$, we deduce that $p^n\mid a$. This implies that $a=0$ because $n$ was arbitrarily chosen. Thus, $a/b=0=c/d$.

    In the general case, where we have two rational numbers $x\ne y$, we can replace $x$ with $x-y$ and $y$ with $0$. According to the case we just saw, there will be some $n$ such that $B_p(x-y,p^{-n})\cap B_p(0,p^{-n})=\emptyset$. Thus, if $z\in B_p(x,p^{-n})\cap B_p(y,p^{-n})$, then
    $$
        |z-y-(x-y)|_p = |z-x|_p < p^{-n}\quad
            \text{and}\quad
            |z-y-0|_p = |z-y|_p < p^{-n},
    $$
    which implies that $z-y\in B_p(x-y,p^{-n})\cap B_p(0,p^{-n})=\emptyset$. Impossible.
\end{solution}

\begin{exr}
    Prove that\/ $\Spec\Z[i]$ is irreducible. What features in the spectral diagram indicate irreducibility?
\end{exr}

\begin{solution}
    Recall that a topological space is \textsl{irreducible} if it cannot be expressed as the union of two proper closed subsets. In our case, since $\Z[i]$ is a domain, Proposition~\ref{prop:generic-point} implies that $\gen0$ is a generic point and, clearly, a topological space with a generic point cannot be reducible.
\end{solution}

\begin{exr}
    Prove that\/ $\Spec\Z C_2$ is reducible. What features in the spectral diagram indicate reducibility?
\end{exr}

\begin{solution}
    Since $(1-\tau)(1+\tau)=0$, we deduce that
    $$
        \Spec\Z C_2=V(1-\tau)\cup V(1+\tau).
    $$
    Moreover, $1+\tau\notin\gen{1-\tau}$. Otherwise, we would have $1+\tau=(a+b\tau)(1-\tau)$ or $1+\tau=a-b+(a+b)\tau$, which is impossible because it would imply $a-b=1$ and $a+b=1$, i.e., $a=1$ and $b=0$ and finally, $1+\tau=1-\tau$. A similar argument shows that $1-\tau\notin\gen{1+\tau}$. 

    \medskip
    
    {\small
    \textbf{Note:} \textit{$\Nil(\Z C_2)=\gen0$}.
    \begin{enumerate}
        \item[$\to$] Suppose that $a+b\tau\in\Nil(\Z C_2)$. Pick $n$ such that $(a+b\tau)^n=0$. Then,
        $$
            0 = \sum_{i=0}^n\binom{n}{i}a^ib^{n-i}\tau^i
                = \sum_{i\text{ even}}\binom{n}{i}a^ib^{n-i} +
                \tau\sum_{i\text{ odd}}\binom{n}{i}a^ib^{n-i}.
        $$
        Therefore,
        $$
            \sum_{i\text{ even}}\binom{n}{i}a^ib^{n-i} = 0
                \quad\text{and}\quad
                \sum_{i\text{ odd}}\binom{n}{i}a^ib^{n-i}=0,
        $$
        which implies, after adding both expressions, that $(a+b)^n=0$, i.e., $b=-a$. Similarly, subtraction produces $(a-b)^n=0$. In consequence, $a=b=0$ and so $\Nil(\Z C_2)=\gen0$.
    \end{enumerate}
    }
\end{solution}

\begin{exr}
    Prove that\/ $\Spec\Z C_3$ is reducible. What features in the spectral diagram indicate reducibility?
\end{exr}

\begin{solution}
    Given that $(1-\tau)(1+\tau+\tau^2)=0$, we have
    $$
        \Spec\Z C_3 = V(1-\tau)\cup V(1+\tau+\tau^2).
    $$
    Suppose that $1-\tau=(a+b\tau+c\tau^2)(1+\tau+\tau^2)$. Then,
    \begin{align*}
        1-\tau &= a(1+\tau+\tau^2) + b(1+\tau+\tau^2)
                + c(1+\tau+\tau^2)\\
            &= a+b+c + (a+b+c)\tau + (a+b+c)\tau^2\\
            &= (a+b+c)(1+\tau+\tau^2),
    \end{align*}
    which implies
    $$
        a+b+c = 1,\quad a+b+c=-1\quad\text{and}\quad a+b+c=0;
    $$
    impossible.

    Suppose that $1+\tau+\tau^2=(a+b\tau+c\tau^2)(1-\tau)$. Then,
    \begin{align*}
        1+\tau+\tau^2 &= a+b\tau+c\tau^2-(c+a\tau+b\tau^2)\\
            &= a-c + (b-a)\tau + (c-b)\tau^2,
    \end{align*}
    i.e.,
    $$
        1 = a-c,\quad1=b-a,\quad\text{and}\quad 1=c-b,
    $$
    hence,
    $$
        2 = b-c\quad\text{and}\quad -1=b-c;
    $$
    impossible.
\end{solution}


\begin{exr}
    Prove that\/ $\Spec(\Z/\gen8)$ is Hausdorff.
\end{exr}

\begin{solution}
    Since $8=2^3$, a prime in $\Z/\gen8$ is a prime in $\Z$ that contains $2$. It follows that
    $$
    \Spec\Z/\gen8=\set{\gen{2\mod8}}
    $$
    which, being a singleton, is tautologically Hausdorff.
\end{solution}

\begin{exr}
    Let\/ $S=\set{\gen{1+i},\gen3,\gen{2+i},\gen7,\gen{11},\gen{3+2i},\dots}$ be endowed with the subspace topology. Determine whether\/ $S$ is homeomorphic to\/ $\Spec\Z$.
\end{exr}

\begin{solution}
    Let's first clarify that $S$ is the set of primes $a+bi$ in $\Z[\iu]$ with $a>0$ and $b\ge0$.

    These two spaces cannot be homeomorphic because every point in $S$ is closed while in $\Spec\Z$ we have the generic point $\gen0$ that isn't closed.
\end{solution}

\begin{exr}
    Let
    $$
        S = \set{\gen{2, 1-\tau}, \gen{2-\tau}, \gen{3-2\tau},
            \dots,
            \gen{\tfrac{p+1}2 - \tfrac{p-1}2\tau}, \dots, \gen{1+\tau}}
    $$
    in\/ $\Spec(\Z C_2)$ be endowed with the subspace topology. Determine whether\/ $S$ is homeomorphic to\/ $\Spec(\Z)$.
\end{exr}

\begin{solution}
    Let $\alpha=a+b\tau$ be an element in $\Z C_2$. Suppose that $\alpha$ is a member of the ideal $\gen{q-(q-1)\tau}$, where $q=(p+1)/2$ for $p\ne2$ prime in~$\Z$. Under these circumstances, there exists $c+d\tau$ such that
    \begin{align*}
        a+b\tau &= (c+d\tau)(q-(q-1)\tau)\\
            &= cq - d(q-1) + (dq-c(q-1))\tau,\\
        \intertext{i.e.,}
        a &= \hphantom-q(c-d)+d\\
        b &= -q(c-d)+c
    \end{align*}
    It follows that
    \begin{align*}
        a-b &= (p+1)(c-d)-(c-d)\\
            &= p(c-d),
        \intertext{i.e.,}
        c-d &= \frac{a-b}{p}\\
        c+d &= a+b
    \end{align*}
or
    \begin{align*}
        2c &= \frac{a-b}p+a+b\\
        2d &= a+b-\frac{a-b}p.
    \end{align*}
    Since $p\ne2$, these equations have one solution for every $p$ with $p\mid a-b$ because, in that case, on the RHS we have even quantities.

    If $p=2$, $a+b\tau\in\gen{2,1+\tau}$ if, and only if, we can write
    \begin{align*}
        a + b\tau &= 2(u+v\tau) + (x+y\tau)(1+\tau)\\
            &= 2u+x+y + (2v+x+y)\tau,
        \intertext{i.e.,}
        a &= 2u+x+y\\
        b &= 2v+x+y,
    \end{align*}
    which are conditions equivalent to $2\mid a-b$. Therefore, the map
    \begin{align*}
        S&\to\Spec\Z\\
        1+\tau&\mapsto 0\\
        \gen{2,1+\tau}&\mapsto2\\
        \frac{p+1}2-\frac{p-1}2\tau&\mapsto p;\quad\text{for }p\ne2,
    \end{align*}
    is a bijection. This bijection is the restriction of the morphism induced by the inclusion $\Z\to\Z C_2$, hence it is continuous. It is an homeomorphsim because it is open: it takes $D_S(a+b\tau)=D_{\Z C_2}(a+b\tau)\cap S$ onto $D_{\Z}(a-b)$.
\end{solution}

\begin{exr}
    Let\/ $X$ be a topological space endowed with the discrete topology, and let\/ $A$ be a non-empty set with at least two elements. Let\/ $a\in A$. Let\/ $\mathcal F(\emptyset) = \set a$, and for each non-empty open subset\/ $U$ of\/ $X$, let\/ $\mathcal F(U) = A$. For non-empty open subsets\/ $V\subseteq U$, let\/ $\rho^U_V$ be the identity function on\/ $A$; otherwise, for\/ $U$ open, put\/ $\rho_\emptyset^U\colon\mathcal F(U)\to\set a$. Show that\/ $\mathcal F$ is a presheaf (of sets) but not a sheaf.
\end{exr}

\begin{solution}
    To see that $\mathcal F$ is a presheaf take $\emptyset\varsubsetneq V\subseteq U$. Then, given $x\in A$, we have
    $$
        \rho^V_\emptyset\circ\rho^U_V(x)=\rho^V_\emptyset(\rho^U_V(x))
            = \rho^V_\emptyset(\id_A(x)) = \rho^V_\emptyset(x)=a
            = \rho^U_\emptyset(x)
    $$
    and similarly for the other variants $\emptyset=V\varsubsetneq U$, $\emptyset\ne W\subseteq V\subseteq U$ etc.

    However, $\mathcal F$ is not a sheaf because we can cover $A$ with two disjoint and not empty sets $U=\set a$ and $V=A\setminus\set a$ and take $a\in\mathcal F(U)$ and $b\ne a$ in $\mathcal F(V)$. These two sections agree on $U\cap V=\emptyset$ because they both restrict to $a$. However, there is no $x\in A$ such that $x|_U=a$ and $x|_V=b$ because that would imply $a=x|_U=x=x|_V=b$.
\end{solution}